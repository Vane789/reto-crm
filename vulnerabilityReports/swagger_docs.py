from drf_yasg import openapi
from drf_yasg.utils import swagger_auto_schema

# Documentación para el endpoint 'all_vulnerabilities'
all_vulnerabilities_schema = swagger_auto_schema(
    operation_description="Obtiene una lista de todas las vulnerabilidades.",
    manual_parameters=[
        openapi.Parameter(
            'resultsPerPage',
            openapi.IN_QUERY,
            description="Número de resultados por página",
            type=openapi.TYPE_INTEGER,
            default=2000
        ),
        openapi.Parameter(
            'startIndex',
            openapi.IN_QUERY,
            description="Índice de inicio de los resultados",
            type=openapi.TYPE_INTEGER,
            default=0
        )
    ],
    responses={
        200: openapi.Response('Respuesta exitosa que incluye una lista de vulnerabilidades.'),
        500: openapi.Response('Server error'),
    }
)

# Documentación para el endpoint 'add_vulnerabilities_fixed'
add_vulnerabilities_fixed_schema = swagger_auto_schema(
    operation_description="Añade vulnerabilidades fixeadas a la base de datos",
    request_body=openapi.Schema(
        type=openapi.TYPE_OBJECT,
        required=['cve_id', 'is_fixed'],
        properties={
            'cve_id': openapi.Schema(type=openapi.TYPE_STRING, description='ID de la vulnerabilidad CVE'),
            'is_fixed': openapi.Schema(type=openapi.TYPE_BOOLEAN, description='Indica si la vulnerabilidad está fixada'),
        }
    ),
    responses={
        201: openapi.Response('Vulnerability added'),
        400: openapi.Response('Invalid data'),
        404: openapi.Response('CVE ID not found'),
        500: openapi.Response('Server error'),
    }
)

# Documentación para el endpoint 'all_vulnerabilities_excluding_fixed'
all_vulnerabilities_excluding_fixed_schema = swagger_auto_schema(
    operation_description="Obtiene una lista de todas las vulnerabilidades que no están fixadas. Este endpoint excluye las vulnerabilidades que han sido marcadas como fixadas en la base de datos.",
    manual_parameters=[
        openapi.Parameter(
            'resultsPerPage',
            openapi.IN_QUERY,
            description="Número de resultados por página",
            type=openapi.TYPE_INTEGER,
            default=2000
        ),
        openapi.Parameter(
            'startIndex',
            openapi.IN_QUERY,
            description="Índice de inicio de los resultados",
            type=openapi.TYPE_INTEGER,
            default=0
        )
    ],

    responses={
        200: openapi.Response('OK'),
        500: openapi.Response('Server error'),
    }  
)
# Documentación para el endpoint 'vulnerabilities_severity_summary'
vulnerabilities_severity_summary_schema = swagger_auto_schema(
    operation_description="Obtiene la sumarización de vulnerabilidades por severidad",
    responses={
        200: openapi.Response(
            description='Respuesta exitosa que incluye un resumen de las vulnerabilidades por severidad.',
            schema=openapi.Schema(
                type=openapi.TYPE_OBJECT,
                properties={
                    'LOW': openapi.Schema(type=openapi.TYPE_INTEGER, description='Total de vulnerabilidades con severidad LOW'),
                    'MEDIUM': openapi.Schema(type=openapi.TYPE_INTEGER, description='Total de vulnerabilidades con severidad MEDIUM'),
                    'HIGH': openapi.Schema(type=openapi.TYPE_INTEGER, description='Total de vulnerabilidades con severidad HIGH'),
                },
                example={
                    'LOW': 120,
                    'MEDIUM': 450,
                    'HIGH': 75
                }
            )
        ),
        500: openapi.Response(
            description='Error interno del servidor.',
            schema=openapi.Schema(
                type=openapi.TYPE_OBJECT,
                properties={
                    'error': openapi.Schema(type=openapi.TYPE_STRING, description='Mensaje de error que proporciona información sobre el problema.')
                },
                example={
                    'error': 'An error occurred while fetching vulnerabilities.'
                }
            )
        )
    }
)
# Documentación para el endpoint 'all_vulnerabilities_fixed'
all_vulnerabilities_fixed_schema = swagger_auto_schema(
    operation_description="Obtiene una lista de todas las vulnerabilidades que han sido fixadas. Este endpoint incluye las vulnerabilidades que han sido marcadas como fixadas en la base de datos.",
    responses={
        200: openapi.Response('OK'),
        500: openapi.Response('Server error'),
    }  
)

# Documentación para el endpoint 'vulnerabilities_id'
vulnerabilities_id_schema = swagger_auto_schema(
    operation_description="Obtiene una vulnerabilidad por su id",
    manual_parameters=[
        openapi.Parameter(
            'cveId',
            openapi.IN_QUERY,
            description="ID de la vulnerabilidad",
            type=openapi.TYPE_STRING
        )
    ],
    responses={200: openapi.Response('Vulnerability details')}
)
